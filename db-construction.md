# 3. 데이터베이스 구축

## 논리 데이터베이스 설계


### E-R (Entity-Relationship) Model
E-R 모델은 개념적 데이터 모델의 가장 대표적인 것으로, 1976년 피터첸에 의해 제안되고 기본적이 구성 요소가 정립되었다.

#### E-R Diagram
- 개체타입: 사각형
- 관계타입: 마름모
- 속성: 타원
- 다중값 속성: 이중타원
- 기본키 속성: 밑줄 타원
- 복합속성: 복수타원
- 대응수: 관계
- 개체타입, 속성 연결: 선

> 예시 
*개체: 고객, 주문서
*속성
**고객 속성: 고객번호, 성명, 주소
**주문서 속성: 주문번호, 품명, 수량, 금액
*관계: `고객`과 `주문서`의 `주문`관계는 일 대 다의 관계, 즉 한사람의 고객이 다수의 주문을 할 수있고 주문서 1개는 특정인의 주문서로 되어 있다.
**밑줄친 속성은 `기본키`를 나타낸다



### 관계형 데이터베이스의 제약 조건 - Key
제약조건이란 데이터베이스에 저장되는 데이터의 정확성을 보장하기 위하여 키를 이용하여 입력되는 데이터에 제한을 주는 것으로 개체 무결성 제약, 참조 무결성 제약 등이 해당된다.

#### 후보키
- 유일성과 최소성을 만족하는 속성 or 속성들의 집합
- 슈퍼키 중 최소성을 만족하는 것이 후보키가 됨
- 후보키는 기본키로 사용할 있으며, 후보키가 여러개일 경우에는 하나를 지정해서 사용.

#### 기본키
- 유일성과 최소성을 만족하는 속성을 가지는 후보키 중에 지정된 하나의 키
- 종복되는 값, Null을 가질 수 없음
- 값의 변화가 거의 없고 단순한 후보키가 기본키로 적합 

#### 대체키
- 대체키는 후보키가 둘 이상일 때 기본키를 제외한 나머지

#### 슈퍼키
- 데이터베이스에서 테이블의 행을 고유하게 식별할 수 있는 속성들의 집합으로 구성된 키.\

#### 외래키
- 다른 릴레이션의 기본키를 참조하는 속성들의 집합
- 외래키는 참조되는 릴레이션의 기본키와 대응되어 릴레이션 간에 참조관계를 표현하는데 중요한 도구이다.



### 정규화(Normalization)
정규화란 함수적 종속성 등의 종속성 이론을 이용하여 잘못 설계된 관계형 스키마를 더 작은 속성의 세트로 쪼개어 바람직한 스키마로 만들어 가는 과정이다.
> 정규화는 데이터의 중복성을 최소화하고 일관성 등을 보장하여 데이터베이스의 품질을 보장하고 성능의 향상을 위해 수행합니다.

- 정규형에는 제 1, 2, 3, 4, 5 정규형, BCNF형이 있으며, 차수가 높아질 수록 만족시켜야 할 제약조건이 늘어난다.

#### 이상(Anomaly)
정규화를 거치지 않으면 데이터베이스 내에 데이터들이 불필요하게 중복되어 릴레이션 조작 시 예기치 못한 곤란한 현상이 발생하는데, 이를 이상이라 하며 삽입 이상, 삭제 이상, 갱신 이상이 있다.

- Insertion Anomaly: 릴레이션에 데이터를 삽입할 때 의도와 상관없이 원하지 않는 값들도 함께 삽입되는 현상이다.
- Deletion Anomaly: 릴레이션에서 한 튜플을 삭제할 때 의도와는 상관없는 값들도 함께 삭제되는 연쇄가 일어나는 현상이다.
- Update Anomaly: 릴레이션에서 튜플에 있는 속성값을 갱신할 때 일부 튜플의 정보만 갱신되어 정보의 모순이 생기는 현상이다.

#### 정규화 과정
- 제1 정규형: 릴레이션에 속한 모든 속성의 도메인이 원자값으로만 구성되어 있으면 제 1 정규형에 속한다.
- 제2 정규형: 제 1 정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속되면 제 2정규형에 속한다.
- 제3 정규형: 제 2정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 이행적 함수 종속이 되지 않으면 제3 정규형에 속한다.
- BCNF(Boyce-codd): 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키이면 보이스/코드 정규형에 속한다.

> 결정자(Determinant)는 속성간의 종속성을 규명할 때 기준이 되는 값이고, 종석자(Dependent)는 결정자의 값에 의해 정해지는 값을 의미합니다.
ex. `학번`에 따라 `이름`이 결정되는 '학번 -> 이름'일 때 `학번`을 결정자, `이름`을 종속자라고 합니다.

- 제4정규형: BCNF 정규형을 만족하면서 함수 종속이 아닌 다치종속을 제거해야 만족
- 제5정규형: 제4정규형을 만족하면서 후보키를 통하지 않는 조인 종속을 제거해야만 만족할 수있다.


> 정규화 단계 암기요령
두부이걸다줘?
도: 메인이 원자값
부: 분적 함수 종속 제거
이: 행적 함수 종속 제거 // A->B B->C: A->C
결: 정자이면서 후보키가 아닌 것 제거
다: 치 종속 제거
조: 인 종속성 이용





### 관계대수 및 관계해석
- 관계대수는 관계형 데이터베이스에서 원하는 정보와 그 정보를 검색하기 위해서 어떻게 유도하는가를 기술하는 절차적인 언어이다.
- 관계해석은 관계 데이터 모델의 제안자인 코드가 수학의 Predicate Caculus에 기반을 두고 관계 데이터베이스를 위해 제안했다. 


### ANY

>Degree & Cardinality
Degree: 열(Column)
Cardinality: 행(row)


## 물리 데이터베이스 설계
## SQL 응용

### SQL의 개념
- 1974년  IBM에서 개발한 SEQUEL에서 유래
- 질의어지만 질의 기능만 있는 것이 아니라 데이터 구조의 정의, 데이터 조작, 데이터 제어 기능을 모두 갖추고 있다.

#### DDL(Data Define Language, 데이터 정의어)
>DDL은 SCHEMA, DOMAIN, TABLE, VIEW, INDEX를 정의하거나 변경 또는 삭제할 때 사용하는 언어이다.
>
>- CREATE: SCHEMA, DOMAIN, TABLE, VIEW, INDEX를 정의한다.
>- ALERT: TABLE에 대한 정의를 변경하는 데 사용한다.
>- DROP: SCHEMA, DOMAIN, TABLE, VIEW, INDEX를 삭제한다.


- Create schema
스키마를 정의하는 명령문
> Schema
스키마는 데이터베이스의 구조와 제약 조건에 관한 전반적인 명세를 기술한 것으로 데이터 개체, 속성, 관계 및 데이터 조작 시 데이터 값을이 갖는 제약 조건 등에 관해 전반적으로 정의합니다.

```sql
CREATE SCHEMA {name} AUTHORIZATION {user_id};

CREATE SCHEMA 대학교 AUTHORIZATION 홍길동;
```

- Create domain
도메인을 정의하는 명령문
> Domain
도메인이란 하나의 속성이 취할 수 있는 동일한 유형의 원자값들의 집합을 의미합니다.
예를 들어 학년 속성의 데이터 타입이 정수형이고 해당 속성에서 취할 수있는 값의 범위가 1-4까지라면, 1-4라는 범위는 해당 속성에 지정된 정수형의 모든 범위가 아니라 일부분이므로 사용자는 1-4의 범위를 해당 속성의 도메인으로 정의해서 사용할 수있다는 의미입니다.
쉽게 말하면 도메인은 특정 속성에서 사용할 데이터의 범위를 사용자가 정의하는 사용자 정의 데이터 타입입니다.

```sql
CREATE DOMAIN {name} [AS] {data type}
    [DEFAULT {value}]
    [CONSTRAINT {name} CHECK {range}];

# data type: SQL에서 지원하는 데이터 타입
# value: 입력하지 않았을 때 자동으로 입력되는 값 

CREATE DOMAIN SEX CHAR(1)
    DEFAULT '남'
    CONSTRAINT VALID-SEX CHECK(VALUE IN('남', '여'));

```

- Create  table
테이블을 정의하는 명령문
```sql
CREATE TABLE {name}
    ({attribute_1 name} {data type} [DEFAULT value] [NOT NULL]
    {arrtibute_2 name},
    ...
    [PRIMARY KEY(name)],
    [UNIQUE(name)],
    [FOREIGN KEY]
        [REFERENCES {}],
        [ON DELETE SET NULL],
        [ON UPDATE CASCADE],
    [CONSTRAINT {}] [CHECK({})]

    
    
    
    
    
    )
```






#### DML(Data Manipulation Language, 데이터 조작어)
>DML은 데이터베이스 사용자가 응용 프로그램이나 질의어를 통하여 저장된 데이터를 실질적으로 처리하는데 사용되는 언어이다.
데이터베이스 사용자와 데이터베이스 관리시스템 간의 인터페이스를 제공한다.

- SELECT: 테이블에서 조건에 맞는 튜플을 검색한다.
- INSERT: 테이블에 새로운 튜플을 삽입한다.
- DELETE: 테이블에서 조건에 맞는 튜플을 삭제한다.
- UPDATE: 테이블에서 조건에 맞는 튜플의 내용을 변경한다.

#### DCL(Data Control Language, 데이터 제어어)
> DCL은 데이터의 보안, 무결성, 회복, 병행 수행 제어 등을 정의하는 데 사용되는 언어이다.
데이터 베이스 관리자가 데이터 관리를 목적으로 사용한다.

- COMMIT: 명령에 의해 수행된 결과를 실제 물리적 디스크로 저장하고, 데이터베이스 조작 작업이 정상적으로 완료되었음을 관리자에게 알려준다.
- ROLLBACK: 데이터베이스 조작 작업이 비정상적으로 종료되었을 때 원래의 상태로 복구한다.
- GRANT: 데이터베이스 사용자에게 사용권한을 부여한다.
- REVOKE: 데이터베이스 사용자의 권한을 취소한다.




## SQL 활용
## 데이터 전환
